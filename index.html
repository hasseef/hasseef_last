<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ููุตุฉ ุญุตูู ุงููุทููุฉ ููุชูุงูู ุงูุชูููู</title>

<!-- Fonts + Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={theme:{extend:{colors:{
 brand:{500:'#0ea5a4',600:'#0f766e'}, gov:{600:'#2563eb',700:'#1e40af'},
 steel:{50:'#f8fafc',100:'#f1f5f9',200:'#e2e8f0',500:'#64748b',700:'#334155',900:'#0f172a'}
},fontFamily:{sans:['Tajawal','ui-sans-serif','system-ui']}}},darkMode:['class','[data-theme="dark"]']};
</script>

<style>
:root{--brand:#0ea5a4;--gov:#2563eb}
*{box-sizing:border-box} body{font-family:'Tajawal',system-ui} html{scroll-behavior:smooth}
.section{scroll-margin-top:88px}
.glass{backdrop-filter:saturate(160%) blur(10px); background:rgba(255,255,255,.75)}
.nav-pill{padding:.45rem .8rem;border-radius:9999px;border:1px solid #e2e8f0;background:#fff}
.nav-pill[aria-current="page"]{background:var(--gov);color:#fff;border-color:var(--gov)}
.card{background:#fff;border:1px solid #e2e8f0;border-radius:1.25rem}
.input{border:1px solid #e2e8f0;border-radius:.9rem;padding:.65rem .9rem;background:#fff}
.btn{border:1px solid #e2e8f0;border-radius:.9rem;padding:.6rem .9rem;background:#fff}
.btn-primary{background:var(--gov);color:#fff;border-color:var(--gov)}
.kpi{border:1px solid #e2e8f0;background:#fff;border-radius:1rem;padding:.7rem}
.kpi-label{font-size:.72rem;color:#64748b}.kpi-value{font-size:1.25rem;font-weight:900;color:#1e40af}
.smart-chip{display:inline-flex;gap:.35rem;align-items:center;border-radius:9999px;border:1px dashed #94a3b8;padding:.15rem .6rem;font-size:.72rem;color:#334155;background:#f8fafc}
.logo{height:30px} @media (max-width:640px){.logo{height:26px}}
</style>
</head>
<body class="bg-steel-50 text-steel-900" data-variant="gov">

<!-- NAV -->
<header class="fixed top-0 inset-x-0 z-50">
  <nav class="mx-auto max-w-7xl px-3 sm:px-6 lg:px-8 py-2">
    <div class="glass shadow px-3 sm:px-4 py-2 rounded-2xl">
      <div class="flex items-center justify-between gap-2">
        <!-- Left logos: Vision + Talbiya -->
        <div class="flex items-center gap-2">
          <img class="logo" alt="Vision 2030" src='data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" width="160" height="40"><rect width="160" height="40" rx="8" fill="%23eef2ff"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Tajawal,Arial" font-weight="700" font-size="16" fill="%231e40af">VISION 2030</text></svg>'/>
          <img class="logo" alt="Talbiya" src='data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" width="140" height="40"><rect width="140" height="40" rx="8" fill="%23ecfeff"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Tajawal,Arial" font-weight="700" font-size="16" fill="%230f766e">TALBIYA</text></svg>'/>
        </div>

        <!-- Desktop nav -->
        <div class="hidden md:flex items-center gap-2 text-sm">
          <a class="nav-pill" data-goto="#login">ุงูุฏุฎูู</a>
          <a class="nav-pill" data-goto="#accounts">ุงูุญุณุงุจุงุช</a>
          <a class="nav-pill" data-goto="#services">ุงูุฎุฏูุงุช</a>
          <a class="nav-pill" data-goto="#map">ุงูุฎุฑูุทุฉ</a>
          <a class="nav-pill" data-goto="#partners">ุงูุดุฑูุงุก</a>
          <a class="nav-pill" data-goto="#docs">ุงููุซุงุฆู</a>
          <a class="nav-pill" data-goto="#support">ุงูุฏุนู</a>
        </div>

        <!-- Right logo: Hasseef -->
        <div class="flex items-center gap-2">
          <img class="logo" alt="Hasseef" src='data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" width="140" height="40"><rect width="140" height="40" rx="8" fill="%23d1fae5"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Tajawal,Arial" font-weight="900" font-size="18" fill="%23047557">ุญูุตูููู</text></svg>'/>
          <button id="menuBtn" class="md:hidden btn" aria-label="ุงููุงุฆูุฉ">โฐ</button>
        </div>
      </div>

      <!-- Mobile -->
      <div id="mobileMenu" class="md:hidden hidden mt-2 rounded-xl border border-white/50 overflow-hidden">
        <div class="grid grid-cols-2 gap-1 p-1 text-sm bg-white/70">
          <a class="nav-pill" data-goto="#login">ุงูุฏุฎูู</a>
          <a class="nav-pill" data-goto="#accounts">ุงูุญุณุงุจุงุช</a>
          <a class="nav-pill" data-goto="#services">ุงูุฎุฏูุงุช</a>
          <a class="nav-pill" data-goto="#map">ุงูุฎุฑูุทุฉ</a>
          <a class="nav-pill" data-goto="#partners">ุงูุดุฑูุงุก</a>
          <a class="nav-pill" data-goto="#docs">ุงููุซุงุฆู</a>
          <a class="nav-pill" data-goto="#support">ุงูุฏุนู</a>
        </div>
      </div>
    </div>
  </nav>
</header>

<main class="pt-24">

<!-- HERO / LOGIN -->
<section id="login" class="section">
  <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
    <div class="grid lg:grid-cols-2 gap-6">
      <div class="card p-6">
        <h1 class="text-2xl sm:text-3xl font-black">ููุตุฉ ุญุตูู ุงููุทููุฉ ููุชูุงูู ุงูุชูููู</h1>
        <p class="mt-2 text-steel-700">ุจูุงุจุฉ ูุทููุฉ ุชุฑุจุท ุงููุทุงุนุงุช (ุงูุญููููุ ุงูุฎุงุตุ ุบูุฑ ุงูุฑุจุญูุ ุงูุฃูุงุฏูููุ ุงูุชูููู) ูุชุญููู ูุณุชูุฏูุงุช ุฑุคูุฉ 2030 ุนุจุฑ ููุงุฐุฌ ููุญูุฏุฉุ ุตูุงุญูุงุช ุฏูููุฉุ ูุณูุฑ ููุงููุงุช ูุชุนุฏูุฏ ุงููุฑุงุญู.</p>
        <ul class="mt-4 text-sm text-steel-700 space-y-2">
          <li>๐งญ ููุงุกูุฉ ุชููุงุฆูุฉ ูุฃูุฏุงู ุงูุฑุคูุฉ + ุงุนุชูุงุฏ ุจุดุฑู.</li>
          <li>๐ค ุดุฑุงูุงุช ูุชุดุจูู ุฐูู ุจูู ุงูุฌูุงุช.</li>
          <li>๐ผ ูุญูุธุฉ ุชุจุฑุนุงุช/ุงุณุชุซูุงุฑ/ุฑุนุงูุฉ ูุณุฌูุงุช ุดูุงูุฉ.</li>
          <li>๐ ููุญุงุช ุฃุซุฑ ูKPIs ููุงููุฉ ูุฅูููููุฉ.</li>
        </ul>
      </div>
      <div class="card p-6">
        <h2 class="text-xl font-extrabold">ุชุณุฌูู ุงูุฏุฎูู ุงูุฑุณูู</h2>
        <form id="loginForm" class="mt-4 grid sm:grid-cols-2 gap-3">
          <div class="sm:col-span-1">
            <label class="text-sm font-semibold">ุงุณู ุงููุณุชุฎุฏู</label>
            <input id="fUser" class="input w-full" placeholder="example@domain.sa" required>
          </div>
          <div class="sm:col-span-1">
            <label class="text-sm font-semibold">ูููุฉ ุงููุฑูุฑ</label>
            <input id="fPass" type="password" class="input w-full" placeholder="โขโขโขโขโขโขโขโข" required>
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm font-semibold">ุงุฎุชูุงุฑ ุงูุญุณุงุจ</label>
            <select id="fAccount" class="input w-full"></select>
          </div>
          <div class="sm:col-span-2 flex items-center justify-between">
            <label class="text-sm text-steel-700 flex items-center gap-2"><input id="fRemember" type="checkbox"> ุชุฐููุฑูู</label>
            <button class="btn btn-primary" type="submit">ุฏุฎูู</button>
          </div>
          <div id="loginMsg" class="sm:col-span-2 hidden text-sm text-red-700">ุชุญูู ูู ุงูุจูุงูุงุช.</div>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- ACCOUNTS -->
<section id="accounts" class="section bg-white">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
      <div>
        <h2 class="text-2xl sm:text-3xl font-black">ุงูุญุณุงุจุงุช</h2>
        <p class="text-steel-600">ุงุฎุชุฑ ุญุณุงุจูุง ูุนุฑุถ ุฎุฏูุงุชู ุงููุงููุฉ.</p>
      </div>
      <input id="accountSearch" type="search" placeholder="ุงุจุญุซ..." class="input w-full sm:w-72">
    </div>

    <div id="accountGrid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <!-- Modal -->
    <div id="accountModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
      <div class="absolute inset-0 bg-black/40" data-close></div>
      <div class="relative max-w-3xl w-full card p-6 shadow-2xl">
        <div class="flex items-start justify-between">
          <div>
            <h3 id="modalTitle" class="text-xl font-extrabold">โ</h3>
            <p id="modalSub" class="mt-1 text-steel-600 text-sm">โ</p>
          </div>
          <button class="btn" data-close>ุฅุบูุงู</button>
        </div>
        <div class="mt-5 grid md:grid-cols-12 gap-4">
          <div class="md:col-span-7 space-y-3">
            <div class="card p-4">
              <h4 class="font-bold">ุงูุฎุฏูุงุช ุงูุฃุณุงุณูุฉ</h4>
              <ul id="modalServices" class="mt-2 text-sm text-steel-700 list-disc pr-5 space-y-1"></ul>
            </div>
            <div class="card p-4">
              <h4 class="font-bold">ุงูุตูุงุญูุงุช</h4>
              <ul id="modalPerms" class="mt-2 text-sm text-steel-700 list-disc pr-5 space-y-1"></ul>
            </div>
          </div>
          <div class="md:col-span-5 space-y-3">
            <div class="rounded-2xl border border-emerald-200 bg-emerald-50 p-4">
              <h4 class="font-bold text-emerald-900">ุงูุฑุจุท ูุงูุชูุงูู</h4>
              <p id="modalApi" class="mt-2 text-sm text-emerald-900">โ</p>
            </div>
            <div class="rounded-2xl border border-yellow-200 bg-yellow-50 p-4">
              <h4 class="font-bold text-yellow-900">ูููุฉ ูุถุงูุฉ</h4>
              <p id="modalValue" class="mt-2 text-sm text-yellow-900">โ</p>
            </div>
          </div>
        </div>
        <div class="mt-6 flex items-center justify-end">
          <a href="#dashboard" class="btn btn-primary">ุฏุฎูู ููุญุฉ ุงูุญุณุงุจ</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- SERVICES -->
<section id="services" class="section">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl sm:text-3xl font-black">ุงูุฎุฏูุงุช ูุงูุตูุงุญูุงุช</h2>
    <div class="mt-6 grid md:grid-cols-2 gap-4">
      <div class="card p-5">
        <h3 class="font-extrabold">ุงูุฎุฏูุงุช ุงููุดุชุฑูุฉ</h3>
        <ul class="mt-2 text-sm text-steel-700 space-y-2">
          <li>ุฅุฏุงุฑุฉ ุงููุจุงุฏุฑุงุช/ุงููุดุงุฑูุนุ ูุญูุธุฉ ูุงููุฉุ ูุฑุต (ูุธุงุฆู/ุชุทูุน/ููุญ/ูุนุงููุงุช)ุ ุชูุงุฑูุฑ ุฃุซุฑ.</li>
          <li>ูุฑุงุณูุงุช ูุฅุดุนุงุฑุงุชุ ุฅุฏุงุฑุฉ ูููุงุช ูุดูุงุฏุงุชุ ุฑุจุท ุฃูุฏุงู ุงูุฑุคูุฉ.</li>
        </ul>
      </div>
      <div class="card p-5">
        <h3 class="font-extrabold">ุทุจูุงุช ุงูุตูุงุญูุงุช</h3>
        <ul class="mt-2 text-sm text-steel-700 space-y-2">
          <li>ุงููุดุฑู ุงูุนุงูุ ูุฏูุฑ ุงููุธุงูุ ูุดุบููุ ูุฑุงูุจุ ุฒุงุฆุฑุ ููุซู ุฌูุฉ ุดุฑููุฉ (ูุงุจูุฉ ููุชุนุฏูู ูู ุงููุงุฌูุฉ).</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- MAP & KPIs -->
<section id="map" class="section bg-white">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl sm:text-3xl font-black">ุงูุฎุฑูุทุฉ ูุงููุคุดุฑุงุช</h2>
    <p class="text-sm text-steel-600">ุงุฑูุน ููู <code>regions.geojson</code> ุจุฌูุงุฑ <code>index.html</code> ูุชูุนูู ุงูููุงุทู.</p>
    <div class="mt-6 grid lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 card p-6">
        <div class="h-[340px] rounded-2xl border border-steel-200 bg-gradient-to-tr from-emerald-50 to-steel-50 p-4 overflow-auto">
          <div id="geoStatus" class="text-sm text-steel-600">ูู ูุชู ุชุญููู GeoJSON ุจุนุฏ.</div>
          <ul id="geoList" class="mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm"></ul>
        </div>
        <div class="mt-3 text-right"><button id="reloadGeo" class="btn">ุฅุนุงุฏุฉ ุงูุชุญููู</button></div>
      </div>
      <div class="card p-6">
        <div class="kpi"><div class="kpi-label">ุงูููุทูุฉ</div><div id="selRegion" class="kpi-value">โ</div></div>
        <div class="grid grid-cols-3 gap-2 mt-3">
          <div class="kpi"><div class="kpi-label">ูุธุงุฆู</div><div id="kpiJobs" class="kpi-value">โ</div></div>
          <div class="kpi"><div class="kpi-label">ููุญ</div><div id="kpiGrants" class="kpi-value">โ</div></div>
          <div class="kpi"><div class="kpi-label">ูุชุทูุนูู</div><div id="kpiVols" class="kpi-value">โ</div></div>
        </div>
        <p class="mt-2 text-xs text-steel-500">ุณูุชู ุงุณุชุจุฏุงู ุงููุงุฆูุฉ ุจุฎุฑูุทุฉ ุชูุงุนููุฉ ุนูุฏ ุชููุฑ ููู ุฑุณูู.</p>
      </div>
    </div>
  </div>
</section>

<!-- DASHBOARD (dynamic) -->
<section id="dashboard" class="section hidden">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <h2 id="dashTitle" class="text-xl sm:text-2xl font-extrabold">ููุญุฉ ุญุณุงุจ โ</h2>
        <p class="text-steel-600">ุณุฌูุงุช ูุฎุฏูุงุช ูุชูุงููุฉ + ุฐูุงุก ูุญูู.</p>
      </div>
      <div class="flex items-center gap-2">
        <a href="#accounts" class="btn">โฌ ุชุบููุฑ ุงูุญุณุงุจ</a>
        <button id="printBtn" class="btn btn-primary">ุชูุฑูุฑ PDF</button>
      </div>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mt-4">
      <div class="kpi"><div class="kpi-label">ูุจุงุฏุฑุงุช/ูุดุงุฑูุน</div><div id="kpiInits" class="kpi-value">0</div></div>
      <div class="kpi"><div class="kpi-label">ุณุฌูุงุช</div><div id="kpiOps" class="kpi-value">0</div></div>
      <div class="kpi"><div class="kpi-label">ุงูุฑุตูุฏ</div><div id="kpiBal" class="kpi-value">0</div></div>
      <div class="kpi"><div class="kpi-label">ูุคุดุฑ ุงูุฃุซุฑ</div><div id="kpiImpact" class="kpi-value">0</div></div>
    </div>

    <div class="mt-5 flex flex-wrap gap-2" id="tabs"></div>
    <div id="panels" class="mt-3"></div>
  </div>
</section>

<!-- PARTNERS/SPONSORS -->
<section id="partners" class="section">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl sm:text-3xl font-black">ุงูุดุฑูุงุก ูุงูุฑุนุงุฉ</h2>
    <div class="mt-6 grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div class="card p-5"><h3 class="font-bold">ุงููุฑูุฒ ุงููุทูู ูุชูููุฉ ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู (NCDC)</h3><p class="text-sm text-steel-700 mt-1">ููุญุงุช ูุคุดุฑุงุช + ุฑุจุท ุจูุงูุงุช.</p></div>
      <div class="card p-5"><h3 class="font-bold">ูุฑูุฒ ุฃุฏุงุก</h3><p class="text-sm text-steel-700 mt-1">ููุงุกูุฉ ุฃูุฏุงู ููุคุดุฑุงุช ูุทููุฉ.</p></div>
      <div class="card p-5"><h3 class="font-bold">ููุดุขุช</h3><p class="text-sm text-steel-700 mt-1">ุชุดุฌูุน ุฑูุงุฏุฉ ุงูุฃุนูุงู ูุงููุธุงุฆู.</p></div>
      <div class="card p-5"><h3 class="font-bold">ุงูุฌุงูุนุงุช</h3><p class="text-sm text-steel-700 mt-1">ุชุนุฒูุฒ ุนููู ูุงุณุชุดุงุฑุงุช.</p></div>
      <div class="card p-5"><h3 class="font-bold">ุงูุฌูุงุช ุงูุชูููููุฉ</h3><p class="text-sm text-steel-700 mt-1">ูุญุงูุธ ูููุญ ูุฑุนุงูุงุช.</p></div>
      <div class="card p-5"><h3 class="font-bold">ุงูุฌูุงุช ุงูุญููููุฉ</h3><p class="text-sm text-steel-700 mt-1">ุชุตุงุฑูุญ ูููุงุกูุฉ ุจุฑุงูุฌ.</p></div>
    </div>
  </div>
</section>

<!-- DOCS -->
<section id="docs" class="section bg-white">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl sm:text-3xl font-black">ุงููุซุงุฆู ูุงูุนููุฏ</h2>
    <p class="text-sm text-steel-600">ุงุฑูุน ุงููููุงุช ุจุฌูุงุฑ <code>index.html</code> ุจููุณ ุงูุฃุณูุงุก ุฃู ุนุฏูู ุงูุฑูุงุจุท.</p>
    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
      <a class="card p-4 hover:shadow" href="./๐ ูุซููุฉ ุงููุธุงู ุงูุชูููุฐู ูุงูุชููู ุงูุดุงูู ูููุตุฉ (1).docx" download>๐ ูุซููุฉ ุงููุธุงู ุงูุชูููุฐู ูุงูุชููู ุงูุดุงูู ูููุตุฉ (1).docx</a>
      <a class="card p-4 hover:shadow" href="./ุงูููู ุงููุงูููู ูุงูุงุณุชุฑุงุชูุฌู ุงูุดุงูู ูุชูุนูู ุงูุดุฑุงูุงุช ูู ููุตุฉ ุญุตูู.docx" download>ุงูููู ุงููุงูููู ูุงูุงุณุชุฑุงุชูุฌู ุงูุดุงูู ูุชูุนูู ุงูุดุฑุงูุงุช</a>
      <a class="card p-4 hover:shadow" href="./ุงูููู ุงููุงูููู ูุงูุงุณุชุฑุงุชูุฌู ุงูุดุงูู ูุชูุนูู ุงูุดุฑุงูุงุช ูู ููุตุฉ ุญุตูู (1).docx" download>ุงูููู ุงููุงููููโฆ (ูุณุฎุฉ 1)</a>
      <a class="card p-4 hover:shadow" href="./ุดุฑุงูุฉ ุนูููุฉ ุงุณุชุฑุงุชูุฌูุฉ ุจูู ุงูุฌุงูุนุงุช ูููุตุฉ ุญุตูู.docx" download>ุดุฑุงูุฉ ุนูููุฉ ุงุณุชุฑุงุชูุฌูุฉ (ุฌุงูุนุงุช)</a>
      <a class="card p-4 hover:shadow" href="./ุดุฑุงูุฉ ุงุณุชุฑุงุชูุฌูุฉ ูุทููุฉ ูุน ููููุงุช ุชุทููุฑ ุงูููุงุทู .docx" download>ุดุฑุงูุฉ ุงุณุชุฑุงุชูุฌูุฉ (ููุฆุงุช ุชุทููุฑ)</a>
      <a class="card p-4 hover:shadow" href="./ูุฑุตุฉ ููููุฉ ุงุณุชุฑุงุชูุฌูุฉ.pdf" download>ูุฑุตุฉ ููููุฉ ุงุณุชุฑุงุชูุฌูุฉ (PDF)</a>
    </div>
  </div>
</section>

<!-- SUPPORT -->
<section id="support" class="section">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl sm:text-3xl font-black">ุงูุฏุนู ูุงูููุชุฑุญุงุช</h2>
    <form class="mt-4 grid lg:grid-cols-2 gap-4">
      <div><label class="text-sm font-semibold">ุงูุงุณู</label><input class="input w-full" placeholder="ุงูุงุณู ุงููุงูู"></div>
      <div><label class="text-sm font-semibold">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input type="email" class="input w-full" placeholder="name@example.com"></div>
      <div class="lg:col-span-2"><label class="text-sm font-semibold">ุงูุฑุณุงูุฉ</label><textarea rows="4" class="input w-full" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."></textarea></div>
      <div class="lg:col-span-2 flex items-center justify-between">
        <label class="text-sm text-steel-700 flex items-center gap-2"><input id="consent" type="checkbox"> ุฃูุงูู ุนูู ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</label>
        <button id="sendBtn" type="button" class="btn btn-primary">ุฅุฑุณุงู</button>
      </div>
      <p id="sendResult" class="lg:col-span-2 hidden text-sm"></p>
    </form>
  </div>
</section>

</main>

<footer class="py-8 border-t border-steel-200 bg-steel-50">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row items-center justify-between gap-3">
    <p class="text-sm text-steel-600">ยฉ 2025 ููุตุฉ ุญุตูู โ ุฌููุน ุงูุญููู ูุญููุธุฉ</p>
    <div class="flex items-center gap-3 text-sm">
      <a href="#docs" class="hover:underline">ุงููุซุงุฆู</a><span class="text-steel-300">|</span>
      <a href="#support" class="hover:underline">ุงูุฏุนู</a>
    </div>
  </div>
</footer>

<!-- Chart.js (lazy) -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
/* ====== STATE ====== */
const KEY='hasseef_portal_v1';
let state=(()=>{try{return JSON.parse(localStorage.getItem(KEY))}catch(_){}})()||{account:null,rows:{},roles:{},role:'ุงููุดุฑู ุงูุนุงู',session:null};
function save(){localStorage.setItem(KEY,JSON.stringify(state))}
const ROLES=['ุงููุดุฑู ุงูุนุงู','ูุฏูุฑ ุงููุธุงู','ูุดุบูู','ูุฑุงูุจ','ุฒุงุฆุฑ','ููุซู ุฌูุฉ ุดุฑููุฉ'];
const PERMS=['ุฅุฏุงุฑุฉ ุงูุญุณุงุจุงุช','ุงุนุชูุงุฏ ุงููุดุงุฑูุน','ุฅุฏุงุฑุฉ ุงูุฑุนุงูุงุช','ุชุนุฏูู ุงูุจูุงูุงุช','ุชูููุฏ ุงูุชูุงุฑูุฑ','ูุตูู API'];
const DEFAULT_PERMS={
 'ุงููุดุฑู ุงูุนุงู':PERMS,
 'ูุฏูุฑ ุงููุธุงู':PERMS,
 'ูุดุบูู':['ุงุนุชูุงุฏ ุงููุดุงุฑูุน','ุฅุฏุงุฑุฉ ุงูุฑุนุงูุงุช','ุชุนุฏูู ุงูุจูุงูุงุช','ุชูููุฏ ุงูุชูุงุฑูุฑ'],
 'ูุฑุงูุจ':['ุชูููุฏ ุงูุชูุงุฑูุฑ'],
 'ุฒุงุฆุฑ':[],
 'ููุซู ุฌูุฉ ุดุฑููุฉ':['ุงุนุชูุงุฏ ุงููุดุงุฑูุน','ุชูููุฏ ุงูุชูุงุฑูุฑ']
};
ROLES.forEach(r=>{state.roles[r]=state.roles[r]||Object.fromEntries(PERMS.map(p=>[p,DEFAULT_PERMS[r].includes(p)]))});

/* ====== DATA (Accounts & Tabs & Modal details) ====== */
const ACCOUNTS=[
 'ุงูุฃูุฑุงุฏ','ุงููุทุงุน ุงูุฎุงุต','ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู','ุงูุฌุงูุนุงุช',
 'ุงูุฌูุงุช ุงูุญููููุฉ','ุงูุฌูุงุช ุงูุชูููููุฉ','ุฅูุงุฑุฉ ุงูููุทูุฉ','ููุฆุงุช ุงูุชุทููุฑ','ุฅุฏุงุฑุฉ ุงูููุตุฉ'
];
const ACCOUNT_TABS={
 'ุงูุฃูุฑุงุฏ':['ุงููุจุงุฏุฑุงุช','ุงููุฑุต','ุงูุชุทูุน','ุงูุชุฏุฑูุจ','ุงูุชูุธูู','ุงููุนุงููุงุช','ุงููุญูุธุฉ','ุงูุชูุงุฑูุฑ'],
 'ุงููุทุงุน ุงูุฎุงุต':['ุงููุดุงุฑูุน','ุงูุฑุนุงูุงุช','ุงููุธุงุฆู','ุงูุชุฏุฑูุจ ุงูุชุนุงููู','ุงูุงุณุชุดุงุฑุงุช','ESG','ุชูุงุฑูุฑ CSRD','ุงููุญูุธุฉ','ุงูุชูุงุฑูุฑ'],
 'ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู':['ุงููุจุงุฏุฑุงุช','ุทูุจุงุช ุงูุชูููู','ุงูุฑุนุงูุงุช','ุงูุชุทูุน','ุงูุชุฏุฑูุจ','ุงููุนุงููุงุช','ุงูุชุตุงุฑูุญ','ุงููุญูุธุฉ','ุงูุชูุงุฑูุฑ'],
 'ุงูุฌุงูุนุงุช':['ุงูุฃุจุญุงุซ','ุงูุงุณุชุดุงุฑุงุช','ุงูุชุฏุฑูุจ ุงูุชุนุงููู','ุงูุญููู','ุงููุฑุงูู','ุงููุนุงููุงุช','ุงููุคุดุฑุงุช','ุงููุญูุธุฉ','ุงูุชูุงุฑูุฑ'],
 'ุงูุฌูุงุช ุงูุญููููุฉ':['ุงูุชุญุฏูุงุช','ุงูุญููู ุงููุณุชููุฉ','ุงููุดุงุฑูุน','ุงูุชุตุงุฑูุญ','ุงููุนุงููุงุช','ุงููุคุดุฑุงุช','ุงูุชููููุงุช','ุงููุญูุธุฉ','ุงูุชูุงุฑูุฑ'],
 'ุงูุฌูุงุช ุงูุชูููููุฉ':['ุทูุจุงุช ุงูุชูููู','ุงูุฑุนุงูุงุช','ุงููุญูุธุฉ','ุชูุงุฑูุฑ ุงูุฃุซุฑ','ุงูุชูุงุฑูุฑ ุงููุงููุฉ','ุงูุชูุงุฑูุฑ'],
 'ุฅูุงุฑุฉ ุงูููุทูุฉ':['ุงูุชุตุงุฑูุญ ุงูุฃูููุฉ','ููุญุฉ ุงูุชูููุฉ','ุฑุนุงูุงุช ุงูุฃููุฑ','ุงููุนุงููุงุช','ุงููุคุดุฑุงุช','ุงููุญุงูุธุงุช','ุงููุญูุธุฉ','ุงูุชูุงุฑูุฑ'],
 'ููุฆุงุช ุงูุชุทููุฑ':['ุจุฑุงูุฌ ุงููุฏู','ุงููุดุงุฑูุน','ุงููุนุงููุงุช','ุงูุชุตุงุฑูุญ','ุงููุคุดุฑุงุช','ุงููุญูุธุฉ','ุงูุดุฑุงูุงุช','ุงูุชูุงุฑูุฑ'],
 'ุฅุฏุงุฑุฉ ุงูููุตุฉ':['ุงูุญุณุงุจุงุช ูุงูุญูููุฉ','ุงูุตูุงุญูุงุช','ุงูุชูุงูู ูุงูุจูุงูุงุช','ุงูุฅุดุนุงุฑุงุช','ุงูุฏุนู','ุงูุชูุงุฑูุฑ','ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูุงูุฃุฏูุงุฑ']
};
const ACCOUNT_DETAILS={
 'ุญุณุงุจ ุงูุฃูุฑุงุฏ':{sub:'ุชูููู ุงูุฃูุฑุงุฏ',services:['ุฅุฏุฑุงุฌ ูุจุงุฏุฑุงุช','ุงูุชูุฏูู ุนูู ุงููุฑุต','ูุญูุธุฉ ูุฑุฏูุฉ','ููู ุฅูุฌุงุฒุงุช'],perms:['ุฅุถุงูุฉ/ุชุนุฏูู','ุงูุชูุฏูู','ุฅุฏุงุฑุฉ ุงููุญูุธุฉ','ุนุฑุถ ุงูุชูุงุฑูุฑ'],api:'POST /api/initiatives โข GET /api/opportunities โข POST /api/wallet',value:'ุฑูุน ุงููุดุงุฑูุฉ ุงููุฌุชูุนูุฉ'},
 'ุญุณุงุจ ุงููุทุงุน ุงูุฎุงุต':{sub:'CSR ูุฑุนุงูุงุช',services:['ููุญ ูุฑุนุงูุฉ','ุชูุงุฑูุฑ ุฃุซุฑ','ููุญุฉ CSR','ุฑุจุท ุญูููู/ุฌุงูุนุงุช'],perms:['ุงุนุชูุงุฏ ุชูููู','ุฅูุดุงุก ุฑุนุงูุฉ','ุชูุงุฑูุฑ ุงูุฃุซุฑ','API ุชูุงุฑูุฑ'],api:'GET /api/csr/reports โข POST /api/grants โข POST /api/sponsorships',value:'ESG/CSRD ูุงุจูุฉ ููููุงุณ'},
 'ุญุณุงุจ ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู':{sub:'ุชูููู ููุคุดุฑุงุช',services:['ุทุฑุญ ูุดุงุฑูุน','ุฌุฐุจ ูุงูุญูู','ุฅุฏุงุฑุฉ ุงูุชุทูุน','ููุงุณ ุฃุซุฑ'],perms:['ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน','ุงุณุชูุงู ุชุจุฑุนุงุช','ุชูุงุฑูุฑ','ุชูุงูู'],api:'POST /api/projects โข GET /api/donors โข GET /api/impact',value:'ุดูุงููุฉ ูุชูุณูุน ุงูุฏุงุนููู'},
 'ุญุณุงุจ ุงูุฌุงูุนุงุช':{sub:'ุชุนุฒูุฒ ุนููู',services:['ุชุนุฒูุฒ ููุงุจููุฉ ุชุทุจูู','ุจุญุซ/ุงุณุชุดุงุฑุงุช','ุชุฏุฑูุจ ุชุนุงููู','ูุฑุงูู'],perms:['ุงุนุชูุงุฏ ุชุนุฒูุฒ','ูุดุฑ ูุฑุต','ุชูุงุฑูุฑ ุนูุงุฆุฏ','ุฅุฏุงุฑุฉ ูุฑุงูู'],api:'POST /api/universities/reviews โข GET /api/internships โข POST /api/facilities',value:'ุงูุชุตุงุฏ ูุนุฑูู'},
 'ุญุณุงุจ ุงูุญูููุฉ':{sub:'ุญููู ููุคุดุฑุงุช',services:['ุญููู ุชูุงูููุฉ','ุงุนุชูุงุฏ ูุนุงููุงุช','ูุคุดุฑุงุช ุงูููุงุทู','ุฑุจุท ุจุงูุฑุคูุฉ'],perms:['ุฅุฏุงุฑุฉ ุงูุญููู','ููุธููุฉ ุงููุนุงููุงุช','ุงุนุชูุงุฏ','ููุญุงุช ูุชูุฏูุฉ'],api:'GET /api/regions/metrics โข POST /api/solutions โข POST /api/events/approvals',value:'ููุงุกุฉ ุงูุฅููุงู'},
 'ุญุณุงุจ ุงููุงูุญูู':{sub:'ูุญูุธุฉ ูุงูุญ',services:['ุชุตููุญ ูุฑุต ุญุณุจ ุงููุนุงููุฑ','ูุญูุธุฉ ูุฅุฏุงุฑุฉ ุงุดุชุฑุงูุงุช','ุชูุงุฑูุฑ ุฃุซุฑ','ุจุฑููุงูู ูุงูุญ'],perms:['ุงุนุชูุงุฏ ููุญ','ุฅุฏุงุฑุฉ ุงููุญูุธุฉ','ูุตูู ุชูุงุฑูุฑ','ุชูุถููุงุช ุงูุชูููู'],api:'GET /api/opportunities?filters=donor โข GET /api/donor/reports โข POST /api/wallet',value:'ุชูุฌูู ูุงูู ูุนูุงู'},
 'ุญุณุงุจ ุงูุดุฑูุงุก ุงูุงุณุชุฑุงุชูุฌููู':{sub:'ููุญุงุช ูุทููุฉ',services:['KPI ููุฌูุงุช ุงููุทููุฉ','ุชูุงุฑูุฑ ูุดุชุฑูุฉ','ุจูุงุจุงุช ุฑุจุท','ููุงูุจ ููุงุณ'],perms:['ุฅุฏุงุฑุฉ ุชูุงูู','ูุฑุงุกุฉ/ุชุตุฏูุฑ','ุงุนุชูุงุฏ ุชูุงุฑูุฑ','ูุทุงูุงุช ุฎุงุตุฉ'],api:'GET /api/partners/kpis โข POST /api/data-exchange โข GET /api/government/gateways',value:'ุชูุงูู ูุทูู ุดุงูู'}
};

/* ====== HELPERS ====== */
const $=(s,c=document)=>c.querySelector(s); const $$=(s,c=document)=>Array.from(c.querySelectorAll(s));
function can(p){return !!state.roles?.[state.role]?.[p]}
function schemaFor(tab){
 switch(tab){
  case'ุงููุจุงุฏุฑุงุช':case'ุงููุดุงุฑูุน':return[['title','ุงูุนููุงู'],['owner','ุงูุฌูุฉ'],['budget','ุงูููุฒุงููุฉ (ุฑ.ุณ)'],['region','ุงูููุทูุฉ'],['status','ุงูุญุงูุฉ']];
  case'ุงููุฑุต':case'ุทูุจุงุช ุงูุชูููู':return[['title','ุงูุนููุงู'],['cat','ุงูุชุตููู'],['amount','ุงููุจูุบ (ุฑ.ุณ)'],['state','ุงูุญุงูุฉ']];
  case'ุงูุฑุนุงูุงุช':return[['title','ุงูุนููุงู'],['cat','ุงูุชุตููู'],['amount','ุงููุจูุบ (ุฑ.ุณ)'],['state','ุงูุญุงูุฉ']];
  case'ุงูุชุตุงุฑูุญ':case'ุงูุชุตุงุฑูุญ ุงูุฃูููุฉ':return[['org','ุงูุฌูุฉ'],['type','ููุน ุงููุดุงุท'],['date','ุงูุชุงุฑูุฎ'],['status','ุงูุญุงูุฉ']];
  case'ุงููุนุงููุงุช':return[['name','ุงุณู ุงููุนุงููุฉ'],['venue','ุงูููุงู'],['date','ุงูุชุงุฑูุฎ'],['status','ุงูุญุงูุฉ']];
  case'ุงูุชุฏุฑูุจ':case'ุงูุชุฏุฑูุจ ุงูุชุนุงููู':return[['program','ุงูุจุฑูุงูุฌ'],['hours','ุงูุณุงุนุงุช'],['type','ุงูููุน'],['status','ุงูุญุงูุฉ']];
  case'ุงูุชุทูุน':return[['title','ุนููุงู ุงููุฑุตุฉ'],['org','ุงูุฌูุฉ'],['hours','ุงูุณุงุนุงุช'],['date','ุงูุชุงุฑูุฎ']];
  case'ุงูุงุณุชุดุงุฑุงุช':return[['topic','ุงูููุถูุน'],['benef','ุงูุฌูุฉ ุงููุณุชููุฏุฉ'],['date','ุงูุชุงุฑูุฎ'],['result','ุงููุชูุฌุฉ']];
  case'ุงููุคุดุฑุงุช':case'ุชูุงุฑูุฑ ุงูุฃุซุฑ':return[['kpi','ุงููุคุดุฑ'],['project','ุงููุดุฑูุน'],['value','ุงููููุฉ'],['unit','ุงููุญุฏุฉ']];
  case'ุงููุญูุธุฉ':return[['benef','ุงูุฌูุฉ ุงููุณุชููุฏุฉ'],['amount','ุงููุจูุบ (ุฑ.ุณ)'],['kind','ููุน ุงูุนูููุฉ'],['note','ูุตู']];
  case'ESG':return[['pillar','ุงููุญูุฑ'],['metric','ุงููุคุดุฑ'],['value','ุงููููุฉ'],['unit','ุงููุญุฏุฉ']];
  case'ุชูุงุฑูุฑ CSRD':return[['topic','ุงูููุถูุน'],['req','ุงููุทูุจ'],['status','ุงูุญุงูุฉ'],['note','ููุงุญุธุฉ']];
  case'ุงูุชูุงูู ูุงูุจูุงูุงุช':return[['endpoint','ููุทุฉ ุงูุชูุงูู'],['method','ุงูุทุฑููุฉ'],['scope','ุงููุทุงู'],['status','ุงูุญุงูุฉ']];
  case'ุงูุญุณุงุจุงุช ูุงูุญูููุฉ':return[['account','ุงูุญุณุงุจ'],['owner','ุงููุงูู'],['status','ุงูุญุงูุฉ'],['note','ููุงุญุธุฉ']];
  default:return[['title','ุงูุนููุงู'],['note','ูุตู'],['date','ุงูุชุงุฑูุฎ'],['status','ุงูุญุงูุฉ']];
 }
}

/* ====== NAV + MOBILE ====== */
$('#menuBtn')?.addEventListener('click',()=>$('#mobileMenu').classList.toggle('hidden'));
$$('[data-goto]').forEach(a=>a.addEventListener('click',()=>{location.hash=a.getAttribute('data-goto');$('#mobileMenu')?.classList.add('hidden')}));

/* ====== LOGIN FLOW ====== */
const fAccount=$('#fAccount'); fAccount.innerHTML=ACCOUNTS.map(a=>`<option>${a}</option>`).join('');
$('#loginForm').addEventListener('submit',e=>{
  e.preventDefault();
  const u=$('#fUser').value.trim(), p=$('#fPass').value.trim(); if(!u||!p){$('#loginMsg').classList.remove('hidden');return}
  state.session={user:u,ts:Date.now(),remember:$('#fRemember').checked}; state.account=$('#fAccount').value; save();
  openDashboard(state.account);
  location.hash='#dashboard';
});

/* ====== ACCOUNTS GRID + SEARCH + MODAL ====== */
const detailsMap=ACCOUNT_DETAILS;
function buildGrid(){
 const g=$('#accountGrid'); const q=($('#accountSearch')?.value||'').trim();
 const list=ACCOUNTS.filter(n=>!q||n.includes(q));
 g.innerHTML=list.map(n=>{
   const title=(n.startsWith('ุญุณุงุจ')?n:'ุญุณุงุจ '+n);
   return `<button class="text-start card p-5 hover:shadow transition" data-acc="${n}">
     <div class="flex items-center justify-between"><h3 class="font-extrabold">${title}</h3>
       <span class="text-xs rounded-full bg-emerald-50 text-emerald-700 px-3 py-1">ูุงูู ุงูุฎุฏูุงุช</span></div>
     <p class="mt-2 text-sm text-steel-700">ููุญุงุช ${n} ูุตูุงุญูุงุช ููู ุงูุฏูุฑ.</p>
   </button>`;
 }).join('');
 $$('#accountGrid [data-acc]').forEach(b=>b.addEventListener('click',()=>{
   const n=b.getAttribute('data-acc'); const title=(n.startsWith('ุญุณุงุจ')?n:'ุญุณุงุจ '+n);
   const d=detailsMap[title]||{sub:'โ',services:[],perms:[],api:'โ',value:'โ'};
   $('#modalTitle').textContent=title; $('#modalSub').textContent=d.sub;
   $('#modalServices').innerHTML=(d.services||[]).map(s=>`<li>${s}</li>`).join('')||'<li>โ</li>';
   $('#modalPerms').innerHTML=(d.perms||[]).map(s=>`<li>${s}</li>`).join('')||'<li>โ</li>';
   $('#modalApi').textContent=d.api; $('#modalValue').textContent=d.value;
   $('#accountModal').classList.remove('hidden'); $('#accountModal').classList.add('flex');
   state.account=n; save();
 }));
}
buildGrid();
$('#accountSearch')?.addEventListener('input',buildGrid);
$('#accountModal')?.addEventListener('click',e=>{if(e.target.hasAttribute('data-close')){$('#accountModal').classList.add('hidden');$('#accountModal').classList.remove('flex')}});

/* ====== DASHBOARD / TABS / TABLES / PERMISSIONS ====== */
function openDashboard(name){
 state.account=name||state.account; if(!state.account) return;
 $('#dashTitle').textContent='ููุญุฉ ุญุณุงุจ โ '+state.account;
 buildTabs(state.account); refreshKPIs();
}
function buildTabs(acc){
 const tabs=ACCOUNT_TABS[acc]||[]; const tabsEl=$('#tabs'), panels=$('#panels');
 tabsEl.innerHTML=tabs.map((t,i)=>`<button class="btn ${i? '':'btn-primary'}" data-tab="${t}" aria-selected="${!i?true:false}">${t}</button>`).join('');
 panels.innerHTML=tabs.map((t,i)=>`<div class="${i?'hidden':''}" data-panel="${t}">${panelTemplate(acc,t)}</div>`).join('');
 $$('#tabs [data-tab]').forEach(b=>b.addEventListener('click',()=>switchTab(b.dataset.tab)));
 bindPanelHandlers();
}
function panelTemplate(acc,tab){
 if(tab==='ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูุงูุฃุฏูุงุฑ') return rolesPanel();
 const key=acc+'::'+tab, schema=schemaFor(tab);
 const heads=schema.map(s=>`<th class="text-right py-2">${s[1]}</th>`).join('')+`<th class="text-right py-2">ุฅุฌุฑุงุกุงุช</th>`;
 const wf=(tab==='ุทูุจุงุช ุงูุชูููู'||tab==='ุงูุฑุนุงูุงุช')?`<button class="btn btn-primary" data-wf="${key}" ${!can('ุฅุฏุงุฑุฉ ุงูุฑุนุงูุงุช')?'disabled':''}>ุณูุฑ ุงูููุงููุงุช</button>`:'';
 return `<div class="card p-4">
   <div class="flex items-center justify-between gap-2">
     <h3 class="font-extrabold">${tab}</h3>
     <div class="flex items-center gap-2">
       ${wf}
       <button class="btn" data-add="${key}" ${!can('ุชุนุฏูู ุงูุจูุงูุงุช')?'disabled':''}>+ ุฅุถุงูุฉ</button>
       <button class="btn" data-export="${key}" ${!can('ุชูููุฏ ุงูุชูุงุฑูุฑ')?'disabled':''}>ุชุตุฏูุฑ CSV</button>
     </div>
   </div>
   <div class="mt-3 overflow-x-auto">
     <table class="w-full text-sm"><thead><tr class="text-steel-600">${heads}</tr></thead><tbody id="tbl::${key}"></tbody></table>
   </div>
 </div>`;
}
function rolesPanel(){
 const th=['ุตูุงุญูุฉ/ุฏูุฑ'].concat(ROLES).map(h=>`<th class="px-3 py-2 text-right">${h}</th>`).join('');
 const rows=PERMS.map(p=>{
   const tds=ROLES.map(r=>`<td class="px-3 py-2"><input type="checkbox" data-role="${r}" data-perm="${p}" ${state.roles[r][p]?'checked':''}></td>`).join('');
   return `<tr><td class="px-3 py-2 font-semibold">${p}</td>${tds}</tr>`;
 }).join('');
 return `<div class="card p-4">
   <div class="flex items-center justify-between"><h3 class="font-extrabold">ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูุงูุฃุฏูุงุฑ</h3>
     <div class="flex items-center gap-2"><button id="rolesReset" class="btn">ุฅุนุงุฏุฉ ุงูุถุจุท</button><button id="rolesSave" class="btn btn-primary">ุญูุธ</button></div></div>
   <div class="mt-3 overflow-x-auto"><table class="w-full text-sm border border-steel-200 rounded-xl"><thead class="bg-steel-50"><tr>${th}</tr></thead><tbody>${rows}</tbody></table></div>
   <p class="mt-2 text-xs text-steel-500">ุงูุชุบููุฑุงุช ุชูุญูุธ ูุญูููุง ูุชุทุจู ููุฑูุง.</p>
 </div>`;
}
function switchTab(tab){
 $$('#tabs [data-tab]').forEach(b=>{const on=b.dataset.tab===tab; b.classList.toggle('btn-primary',on); b.setAttribute('aria-selected',on)});
 $$('#panels [data-panel]').forEach(p=>p.classList.toggle('hidden',p.dataset.panel!==tab));
}
function bindPanelHandlers(){
 $$('[data-add]').forEach(b=>b.onclick=()=>{if(!can('ุชุนุฏูู ุงูุจูุงูุงุช'))return alert('ุตูุงุญูุฉ ุบูุฑ ูุงููุฉ'); const key=b.dataset.add; const schema=schemaFor(key.split('::')[1]); const row={}; schema.forEach(s=>row[s[0]]=prompt('ุฃุฏุฎู '+s[1])||''); (state.rows[key]=state.rows[key]||[]).push(row); save(); renderTable(key,true); refreshKPIs();});
 $$('[data-export]').forEach(b=>b.onclick=()=>{if(!can('ุชูููุฏ ุงูุชูุงุฑูุฑ'))return alert('ุตูุงุญูุฉ ุบูุฑ ูุงููุฉ'); const key=b.dataset.export, list=state.rows[key]||[]; if(!list.length)return alert('ูุง ุจูุงูุงุช'); const headers=Object.keys(list[0]); const csv=[headers.join(',')].concat(list.map(r=>headers.map(h=>JSON.stringify(r[h]??'')).join(','))).join('\n'); const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); const a=document.createElement('a'); a.href=url; a.download=key.replaceAll('::','_')+'.csv'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),500);});
 $$('[data-wf]').forEach(b=>b.onclick=()=>alert('ุณูุฑ ุงูููุงููุงุช (ุชุฌุฑูุจู):\nโข ุชูุฏูู โ ูุฑุงุฌุนุฉ ูุฌูุฉ โ ุชูููุน ุฑููู โ ุชูููุฐ'));
 if($('#rolesSave')){$('#rolesSave').onclick=()=>{save(); alert('ุชู ุงูุญูุธ')}; $('#rolesReset').onclick=()=>{state.roles={}; ROLES.forEach(r=>state.roles[r]=Object.fromEntries(PERMS.map(p=>[p,DEFAULT_PERMS[r].includes(p)]))); save(); buildTabs(state.account)}; $$('input[type="checkbox"][data-role]').forEach(ch=>ch.onchange=()=>{state.roles[ch.dataset.role][ch.dataset.perm]=ch.checked; save();});}
 Object.keys(state.rows).forEach(k=>renderTable(k,false));
}
function renderTable(key,enrich){
 const el=document.getElementById('tbl::'+key); if(!el) return;
 const tab=key.split('::')[1], schema=schemaFor(tab), list=state.rows[key]||[];
 if(enrich&&(tab==='ุงููุจุงุฏุฑุงุช'||tab==='ุงููุดุงุฑูุน')){const row=list[list.length-1]; if(row) enrichRow(row);}
 el.innerHTML=list.length?list.map((r,i)=>rowHTML(r,i,schema,key,tab)).join(''):`<tr><td class="py-4 text-center text-steel-500" colspan="${schema.length+1}">ูุง ุชูุฌุฏ ุจูุงูุงุช</td></tr>`;
 function rowHTML(r,i,sch,key,tab){
   const tds=sch.map(s=>`<td class="py-2">${r[s[0]]||''}</td>`).join('');
   const chip=(tab==='ุงููุจุงุฏุฑุงุช'||tab==='ุงููุดุงุฑูุน')?`<div class="mt-1">${smartChip(r)}</div>`:'';
   return `<tr><td colspan="100%"><div class="grid md:grid-cols-12 gap-2 items-start">
     <div class="md:col-span-9"><table class="w-full"><tr>${tds}<td class="py-2 flex items-center gap-3">
       <button class="text-blue-700" data-edit="${key}::${i}" ${!can('ุชุนุฏูู ุงูุจูุงูุงุช')?'disabled':''}>ุชุนุฏูู</button>
       <button class="text-red-700" data-del="${key}::${i}" ${!can('ุชุนุฏูู ุงูุจูุงูุงุช')?'disabled':''}>ุญุฐู</button>
     </td></tr></table>${chip}</div><div class="md:col-span-3"></div></div></td></tr>`;
 }
 $$(`[data-edit^="${key}::"]`).forEach(b=>b.onclick=()=>{if(!can('ุชุนุฏูู ุงูุจูุงูุงุช'))return; const idx=+b.dataset.edit.split('::').pop(); const sc=schemaFor(tab); sc.forEach(s=>{list[idx][s[0]]=prompt('ุชุนุฏูู '+s[1],list[idx][s[0]]||'')??list[idx][s[0]]}); if(tab==='ุงููุจุงุฏุฑุงุช'||tab==='ุงููุดุงุฑูุน')enrichRow(list[idx]); save(); renderTable(key,false); refreshKPIs();});
 $$(`[data-del^="${key}::"]`).forEach(b=>b.onclick=()=>{if(!can('ุชุนุฏูู ุงูุจูุงูุงุช'))return; const idx=+b.dataset.del.split('::').pop(); if(confirm('ุญุฐู ุงูุณุฌูุ')){list.splice(idx,1); save(); renderTable(key,false); refreshKPIs();}});
}
function refreshKPIs(){
 const acc=state.account; if(!acc) return;
 let inits=0,ops=0,bal=0,impact=0;
 Object.entries(state.rows).forEach(([k,list])=>{ if(!k.startsWith(acc+'::'))return;
   if(/ุงููุจุงุฏุฑุงุช|ุงููุดุงุฑูุน/.test(k)) inits+=list.length;
   if(!/ุงููุญูุธุฉ/.test(k)) ops+=list.length;
   if(/ุงููุคุดุฑุงุช|ุชูุงุฑูุฑ ุงูุฃุซุฑ/.test(k)) impact+=list.reduce((a,r)=>a+(+r.value||0),0);
   if(/::ุงููุญูุธุฉ$/.test(k)) bal=list.reduce((a,r)=>a+(+r.amount||0),0);
 });
 $('#kpiInits').textContent=inits; $('#kpiOps').textContent=ops; $('#kpiBal').textContent=new Intl.NumberFormat('ar-SA').format(bal); $('#kpiImpact').textContent=impact;
}

/* ====== SIMPLE AI HINTS (local) ====== */
const TAGS=[{c:'QOL',w:['ุซูุงูุฉ','ุฑูุงุถุฉ','ุชุฑููู','ุณูุงุญุฉ']},{c:'HEALTH',w:['ุตุญุฉ','ุนูุงุฌ','ุทุจู']},{c:'EDU',w:['ุชุนููู','ุชุฏุฑูุจ','ุฌุงูุนุฉ','ููุงุฑุงุช']},{c:'ECON',w:['ูุธุงุฆู','ุงุณุชุซูุงุฑ','ููุดุขุช','ุฑูุงุฏุฉ']},{c:'ENV',w:['ุจูุฆุฉ','ุชุดุฌูุฑ','ููุงูุงุช','ููุงู']},{c:'GOV',w:['ุญูููุฉ','ุชุตุงุฑูุญ','ุฎุฏูุงุช']}];
function classify(text){text=(text||'').toLowerCase();const s={};TAGS.forEach(t=>s[t.c]=t.w.reduce((a,k)=>a+(text.includes(k.toLowerCase())?1:0),0));return Object.entries(s).filter(([,v])=>v>0).map(([c,v])=>({code:c,score:v})).sort((a,b)=>b.score-a.score).slice(0,2)}
function matchPartners(row){const p=[{n:'ูุฑูุฒ ุฃุฏุงุก',f:['GOV','ECON']},{n:'NCDC',f:['GOV','QOL']},{n:"Monsha'at",f:['ECON']},{n:'ุฌุงูุนุฉ ุญุงุฆู',f:['EDU','ENV']},{n:'ุดุฑูุฉ ูุทููุฉ (CSR)',f:['QOL','ENV','EDU']}];const tags=classify((row.title||'')+' '+(row.note||'')).map(x=>x.code);return p.map(x=>({name:x.n,score:+(x.f.some(f=>tags.includes(f))?0.9:0.3).toFixed(2)})).sort((a,b)=>b.score-a.score)}
function risk(row){let r=0; if((+row.budget||0)>50000) r+=2; if(/ูุนุงููุฉ|ุชุฌูุน/.test(row.title||'')) r+=1; return {level:r>=3?'ูุฑุชูุน':r==2?'ูุชูุณุท':'ููุฎูุถ'}}
function enrichRow(r){r._tags=classify((r.title||'')+' '+(r.note||'')); r._matches=matchPartners(r); r._risk=risk(r)}
function smartChip(r){const t=(r._tags||[]).map(x=>x.code).join('ยท')||'โ'; const m=(r._matches||[])[0]; const best=m?`${m.name} (${(m.score*100).toFixed(0)}%)`:'โ'; const rk=r._risk?r._risk.level:'โ'; return `<span class="smart-chip">๐ฏ ${t} โข ๐ค ${best} โข โ๏ธ ${rk}</span>`}

/* ====== MAP (GeoJSON) ====== */
async function tryLoadGeo(){
  const s=$('#geoStatus'), L=$('#geoList'); L.innerHTML=''; s.textContent='ูุญุงููุฉ ุชุญููู regions.geojson...';
  try{const r=await fetch('./regions.geojson?'+Date.now()); if(!r.ok) throw 0; const g=await r.json(); const f=g.features||[]; s.textContent='ุชู ุงูุชุญููู: '+f.length+' ููุทูุฉ.'; L.innerHTML=f.map((x,i)=>{const n=(x.properties?.name_ar||x.properties?.name||'ููุทูุฉ #'+(i+1)); return `<button class="border rounded-xl px-3 py-2 hover:border-brand-600 text-right" data-r="${n}">${n}</button>`}).join(''); L.querySelectorAll('button').forEach(b=>b.onclick=()=>{const n=b.dataset.r; $('#selRegion').textContent=n; $('#kpiJobs').textContent=Math.floor(Math.random()*300)+50; $('#kpiGrants').textContent=Math.floor(Math.random()*100)+10; $('#kpiVols').textContent=Math.floor(Math.random()*1000)+100;});}
  catch{ s.textContent='ุชุนุฐุฑ ุงูุชุญููู โ ุงุฑูุน regions.geojson ุจุฌูุงุฑ index.html'; }
}
$('#reloadGeo')?.addEventListener('click',tryLoadGeo);

/* ====== SUPPORT form ====== */
const sendBtn=$('#sendBtn'), sendRes=$('#sendResult'); sendBtn?.addEventListener('click',()=>{if(!$('#consent').checked){sendRes.textContent='ูุถูุงู ูุงูู ุนูู ุณูุงุณุฉ ุงูุฎุตูุตูุฉ.'; sendRes.className='lg:col-span-2 text-sm text-red-700 bg-red-50 border border-red-200 rounded-xl px-4 py-3'; sendRes.classList.remove('hidden');return;} sendRes.textContent='ุชู ุงุณุชูุงู ุงูุฑุณุงูุฉ โ ุดูุฑูุง ููู!'; sendRes.className='lg:col-span-2 text-sm text-emerald-800 bg-emerald-50 border border-emerald-200 rounded-xl px-4 py-3'; sendRes.classList.remove('hidden')});

/* ====== PRINT ====== */
$('#printBtn')?.addEventListener('click',()=>window.print());

/* ====== INIT ====== */
function renderAccounts(){ // for login select
  fAccount.innerHTML=ACCOUNTS.map(a=>`<option>${a}</option>`).join('');
}
function panelSeed(acc){
  // ุชุนุจุฆุฉ ุณุฑูุนุฉ ูุนุฑุถ ููู
  const push=(tab,rows)=>state.rows[acc+'::'+tab]=rows;
  (ACCOUNT_TABS[acc]||[]).forEach(tab=>{
    switch(tab){
      case'ุงููุจุงุฏุฑุงุช':case'ุงููุดุงุฑูุน':push(tab,[{title:'ูุจุงุฏุฑุฉ ุชุดุฌูุฑ ุงูุฃุญูุงุก',owner:acc,budget:'150000',region:'ุญุงุฆู',status:'ุฌุงุฑูุฉ'},{title:'ุจุฑูุงูุฌ ุชูููู ุงูุดุจุงุจ',owner:acc,budget:'80000',region:'ุงูุฑูุงุถ',status:'ููุชููุฉ'}]); break;
      case'ุทูุจุงุช ุงูุชูููู':case'ุงููุฑุต':push(tab,[{title:'ุชูููู ููุตุฉ ุชุนููููุฉ',cat:'ุชุนูููู',amount:'120000',state:'ููุชูุญุฉ'}]); break;
      case'ุงูุฑุนุงูุงุช':push(tab,[{title:'ุฑุนุงูุฉ ููุชูู ูุทูู',cat:'ูุนุงููุงุช',amount:'70000',state:'ููุฏ ุงููุฑุงุฌุนุฉ'}]); break;
      case'ุงููุญูุธุฉ':push(tab,[{benef:'ุชูููู ุงูุดุจุงุจ',amount:'200000',kind:'ุชูููู',note:'ุฏูุนุฉ ุฃููู'}]); break;
      case'ุงููุคุดุฑุงุช':case'ุชูุงุฑูุฑ ุงูุฃุซุฑ':push(tab,[{kpi:'ุนุฏุฏ ุงููุณุชููุฏูู',project:'ุชูููู ุงูุดุจุงุจ',value:'120',unit:'ุดุฎุต'}]); break;
      default:push(tab,[{title:tab+' โ ุณุฌู ุชุฌุฑูุจู',note:'...',date:'2025-10-21',status:'โ'}]);
    }
  });
  Object.keys(state.rows).forEach(k=>{if(k.startsWith(acc+'::')&&(k.endsWith('ุงููุจุงุฏุฑุงุช')||k.endsWith('ุงููุดุงุฑูุน')))(state.rows[k]||[]).forEach(enrichRow)});
  save();
}
function refreshKPIsOnAccount(acc){ state.account=acc; save(); refreshKPIs(); }
function buildAccountsSection(){
  const grid=$('#accountGrid');
  grid.innerHTML=ACCOUNTS.map(n=>`<button class="text-start card p-5 hover:shadow" data-open="${n}"><div class="flex items-center justify-between"><h3 class="font-extrabold">ุญุณุงุจ ${n}</h3><span class="text-xs rounded-full bg-emerald-50 text-emerald-700 px-3 py-1">ูุงูู ุงูุฎุฏูุงุช</span></div><p class="mt-2 text-sm text-steel-700">ุงุณุชุนุฑุงุถ ุฎุฏูุงุช ${n}.</p></button>`).join('');
  $$('#accountGrid [data-open]').forEach(b=>b.onclick=()=>{state.account=b.dataset.open; save(); panelSeed(state.account); openDashboard(state.account); location.hash='#dashboard';});
}
renderAccounts(); buildAccountsSection();
</script>
</body>
</html>
